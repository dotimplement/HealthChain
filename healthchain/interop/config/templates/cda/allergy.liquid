{
  "resourceType": "AllergyIntolerance",
  "id": "{{ entry.id | generate_id }}",
  "clinicalStatus": {
    "coding": [{
      "system": "http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical",
      "code": "{{ entry.status | map_status: 'cda_to_fhir' }}"
    }]
  },
  "code": {
    "coding": [{
      "system": "{{ entry.observation.value.codeSystem | map_system: 'cda_to_fhir' }}",
      "code": "{{ entry.observation.value.code }}",
      "display": "{{ entry.observation.value.displayName }}"
    }]
  },
  {% if entry.effectiveTime %}
  "onsetDateTime": "{{ entry.effectiveTime.value | format_date }}",
  {% endif %}
  "subject": {
    "reference": "Patient/{{ entry.subject_id | default: 'example' }}"
  },
  {% if entry.observation.entryRelationship %}
  "reaction": [{
    {% if entry.observation.entryRelationship.observation.value %}
    "manifestation": [{
      "coding": [{
        "system": "{{ entry.observation.entryRelationship.observation.value.codeSystem | map_system }}",
        "code": "{{ entry.observation.entryRelationship.observation.value.code }}",
        "display": "{{ entry.observation.entryRelationship.observation.value.displayName }}"
      }]
    }],
    {% endif %}
    {% if entry.observation.entryRelationship.observation.entryRelationship %}
    "severity": "{{ entry.observation.entryRelationship.observation.entryRelationship.observation.value.code | map_severity }}"
    {% endif %}
  }]
  {% endif %}
}
